import{j as s,u as f,s as I,a as b,c as x,t as E,l as j,o as S,v as k,m as O,w as C,x as y,P as D,y as A,T as N,d as T,b as p,z as M,e as $,A as B,C as w,g as L}from"./index-C-sK9tWO.js";import{u as F,a as P,C as z}from"./ClassroomGrid-jHaf7UAT.js";import{S as H}from"./SecondaryButton-Dk2dblrN.js";import{H as v}from"./H4-DpEsmjiN.js";const R=({value:e,className:t})=>s.jsx("h2",{className:`text-xl font-bold mb-4 text-text ${t}`,children:e}),U=({id:e})=>{const t=f(c=>I(c,e)),n=b(),[{isDragging:a},l]=F(()=>({type:"STUDENT",item:{id:e,fromCoords:{row:null,col:null},action:"set"},collect:c=>({isDragging:!!c.isDragging()})}));return x.useEffect(()=>{n(E(a))},[a]),s.jsx(s.Fragment,{children:!t.isAssigned&&s.jsx("div",{ref:l,className:`flex justify-center items-center px-4 py-2 my-2 bg-element hover:bg-element-hover transition-colors border border-border rounded-lg cursor-pointer select-none
                     ${a&&"border-default"}`,children:s.jsx(v,{value:t.name})})})},_=j("students/unAssignStudent",async({coords:e},{getState:t,dispatch:n})=>{const l=t().grid.deskSetup[e.row][e.col].studentId;l&&(n(S({id:l,val:!1})),n(k({row:e.row,col:e.col,id:null})))}),W=(e,t)=>{const[n,a]=x.useState(!1);return x.useEffect(()=>{const l=()=>{e.current&&a(e.current.scrollWidth>e.current.clientWidth)};return l(),window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},t),n},G=j("students/clearAssignments",async(e,{dispatch:t})=>{t(O()),t(C())}),q=j("students/randAssignStudents",async(e,{getState:t,dispatch:n})=>{const a=t(),l=Object.values(a.students.entities),c=a.grid.deskSetup,i=[];c.forEach((r,o)=>{r.forEach((d,h)=>{d.deskState===1&&!d.studentId&&i.push({row:o,col:h})})});const u=l.filter(r=>!r.isAssigned).map(r=>r.id).sort(()=>Math.random()-.5),g=i.sort(()=>Math.random()-.5);u.forEach((r,o)=>{if(g[o]){const{row:d,col:h}=g[o];n(S({id:r,val:!0})),n(k({row:d,col:h,id:r}))}})}),J=()=>{const e=b(),n=f(y).every(a=>a.isAssigned);return s.jsxs("div",{className:"flex flex-row justify-between",children:[s.jsx(D,{onClick:()=>e(q()),disabled:n,children:A("screens.assign.dnd.autoAssign")}),s.jsx(N,{onClick:()=>e(G()),children:A("screens.assign.dnd.clearAssign")})]})},K=()=>{const e=b(),t=f(T),n=f(o=>o.grid.dndState),l=f(y).every(o=>o.isAssigned),c=x.useRef(null),i=W(c,[t]),m=p(),[{isOver:u},g]=P(()=>({accept:"STUDENT",drop:o=>r({...o}),collect:o=>({isOver:!!o.isOver()})})),r=({fromCoords:o})=>{e(_({coords:{row:o.row,col:o.col}}))};return x.useEffect(()=>{e(M(u))},[u]),s.jsxs(s.Fragment,{children:[s.jsx(R,{value:m("screens.assign.dnd.heading")}),s.jsxs("div",{ref:g,className:Q({isOver:u,dndState:n}),children:[s.jsxs("div",{ref:c,className:`flex flex-row overflow-x-scroll gap-2 ${n.isDragging&&"opacity-10"} transition-all`,children:[t.map((o,d)=>s.jsx(U,{id:o},`${o}-${d}`)),l&&s.jsx("div",{className:"",children:s.jsx(v,{value:m("screens.assign.dnd.allAssigned")})})]}),n.isDragging&&s.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",children:s.jsx(v,{value:u?"Drop here... ":"Unassign Student"})}),i&&!l&&s.jsx("div",{className:"absolute top-0 right-0 h-full w-6 bg-gradient-to-l from-background rounded-r-lg to-transparent pointer-events-none"})]}),s.jsx(J,{})]})},Q=({isOver:e,dndState:t})=>`relative flex items-center px-2 mb-2 -mt-2 rounded-lg border-2 border-transparent hover:border-border min-h-14
        ${e&&"!border-warning shadow-md shadow-warning"} 
        ${t.isDragging&&!e&&"!border-default"}
        ${t.isDragging&&!t.isOver&&"shadow-md shadow-default"}
        transition-all`,V=j("students/shuffleAssignedStudents",async(e,{getState:t,dispatch:n})=>{const a=t(),l=Object.values(a.students.entities),c=a.grid.deskSetup,i=l.filter(r=>r.isAssigned).map(r=>r.id);n(C());const m=[];for(let r=0;r<c.length;r++){const o=c[r];for(let d=0;d<o.length;d++)o[d].deskState===1&&m.push({row:r,col:d})}const u=i.sort(()=>Math.random()-.5),g=m.sort(()=>Math.random()-.5);u.forEach((r,o)=>{if(g[o]){const{row:d,col:h}=g[o];n(S({id:r,val:!0})),n(k({row:d,col:h,id:r}))}})}),X=({link:e,copied:t,setCopied:n})=>{const a=p(),l=()=>{navigator.clipboard.writeText(e),n(!0)};return s.jsx("button",{onClick:l,className:`pl-4 py-2 pr-4 border-default border-2 rounded-r-lg hover:bg-hover ${t&&"border-success hover:bg-success"} transition-colors`,"aria-label":"Copy link to clipboard",children:s.jsx(v,{value:a("common.copy")})})},Y=()=>{const[e,t]=x.useState(!1),n=p(),a=f(y),l=f(i=>i.grid.deskSetup),c=B(l,a);return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("input",{className:"w-full bg-card text-text-muted border-element border-y-2 border-l-2 rounded-l-lg py-2 pl-2 font-medium",value:c,disabled:!0}),s.jsx(X,{link:c,copied:e,setCopied:t})]}),e&&s.jsx("h6",{className:"font-semibold text-sm text-success pl-2",children:n("components.export.copiedToClipboard")})]})},Z=()=>{const{showModal:e,hideModal:t}=$(),n=p();return()=>e({title:n("modals.export.heading"),component:s.jsx(Y,{}),confirmText:n("common.done"),cancelText:n("common.cancel"),onCancel:t})},os=()=>{const e=b(),t=Z(),n=p(),a=()=>{e(L(2))},l=()=>{t()};return s.jsxs(s.Fragment,{children:[s.jsx(w,{className:"relative",children:s.jsx(K,{})}),s.jsxs(w,{className:"flex flex-col gap-4",children:[s.jsx(z,{disabled:!0}),s.jsx("div",{className:"flex flex-row justify-end w-full",children:s.jsx(D,{onClick:()=>e(V()),children:n("screens.assign.shuffle")})})]}),s.jsxs(w,{className:"flex flex-row justify-between",children:[s.jsx(N,{onClick:a,children:n("common.goBack")}),s.jsx(H,{onClick:l,children:n("common.export")})]})]})};export{os as default};
