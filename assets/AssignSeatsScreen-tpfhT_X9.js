import{t as E,j as s,u as g,s as T,a as h,c as x,v as M,l as k,o as v,w as S,x as I,y,P as D,z as C,T as N,d as B,b as m,A as O,e as $,B as z,D as L,C as w,g as _}from"./index-lEqb2WGH.js";import{u as W,a as F,L as P,b as U,T as H,C as R}from"./ClassroomGrid-FJ06w4Ij.js";import{S as A}from"./SecondaryButton-BNnTEFvZ.js";import{H as j}from"./H4-CVbMHXFZ.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],q=E("Info",G),J=({value:e,className:t})=>s.jsx("h2",{className:`text-xl font-bold mb-4 text-text ${t}`,children:e}),K=({id:e})=>{const t=g(a=>T(a,e)),n=h(),[{isDragging:c},r]=W(()=>({type:"STUDENT",item:{id:e,fromCoords:{row:null,col:null},action:"set"},collect:a=>({isDragging:!!a.isDragging()})}));return x.useEffect(()=>{n(M(c))},[c]),s.jsx(s.Fragment,{children:!t.isAssigned&&s.jsx("div",{ref:r,className:`flex justify-center items-center px-4 py-2 my-2 bg-element hover:bg-element-hover transition-colors border border-border rounded-lg cursor-pointer select-none
                     ${c&&"border-default"}`,children:s.jsx(j,{value:t.name})})})},Q=k("students/unAssignStudent",async({coords:e},{getState:t,dispatch:n})=>{const r=t().grid.deskSetup[e.row][e.col].studentId;r&&(n(v({id:r,val:!1})),n(S({row:e.row,col:e.col,id:null})))}),V=(e,t)=>{const[n,c]=x.useState(!1);return x.useEffect(()=>{const r=()=>{e.current&&c(e.current.scrollWidth>e.current.clientWidth)};return r(),window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},t),n},X=k("students/clearAssignments",async(e,{dispatch:t})=>{t(Y()),t(I())}),Y=k("students/clearStudentAssignements",async(e,{getState:t,dispatch:n})=>{t().grid.deskSetup.flat().filter(a=>!a.isLocked).map(a=>a.studentId).forEach(a=>{a&&n(v({id:a,val:!1}))})}),Z=k("students/randAssignStudents",async(e,{getState:t,dispatch:n})=>{const c=t(),r=Object.values(c.students.entities),a=c.grid.deskSetup,u=[];a.forEach((d,o)=>{d.forEach((i,b)=>{i.deskState===1&&!i.studentId&&!i.isLocked&&u.push({row:o,col:b})})});const f=r.filter(d=>!d.isAssigned).map(d=>d.id).sort(()=>Math.random()-.5),l=u.sort(()=>Math.random()-.5);f.forEach((d,o)=>{if(l[o]){const{row:i,col:b}=l[o];n(v({id:d,val:!0})),n(S({row:i,col:b,id:d}))}})}),ss=()=>{const e=h(),n=g(y).every(c=>c.isAssigned);return s.jsxs("div",{className:"flex flex-row justify-between",children:[s.jsx(D,{onClick:()=>e(Z()),disabled:n,children:C("screens.assign.dnd.autoAssign")}),s.jsx(N,{onClick:()=>e(X()),children:C("screens.assign.dnd.clearAssign")})]})},es=()=>{const e=h(),t=g(B),n=g(o=>o.grid.dndState),r=g(y).every(o=>o.isAssigned),a=x.useRef(null),u=V(a,[t]),p=m(),[{isOver:f},l]=F(()=>({accept:"STUDENT",drop:o=>d({...o}),collect:o=>({isOver:!!o.isOver()})})),d=({fromCoords:o})=>{e(Q({coords:{row:o.row,col:o.col}}))};return x.useEffect(()=>{e(O(f))},[f]),s.jsxs(s.Fragment,{children:[s.jsx(J,{value:p("screens.assign.dnd.heading")}),s.jsxs("div",{ref:l,className:ts({isOver:f,dndState:n}),children:[s.jsxs("div",{ref:a,className:`flex flex-row overflow-x-scroll gap-2 ${n.isDragging&&"opacity-10"} transition-all`,children:[t.map((o,i)=>s.jsx(K,{id:o},`${o}-${i}`)),r&&s.jsx("div",{className:"",children:s.jsx(j,{value:p("screens.assign.dnd.allAssigned")})})]}),n.isDragging&&s.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",children:s.jsx(j,{value:f?"Drop here... ":"Unassign Student"})}),u&&!r&&s.jsx("div",{className:"absolute top-0 right-0 h-full w-6 bg-gradient-to-l from-background rounded-r-lg to-transparent pointer-events-none"})]}),s.jsx(ss,{})]})},ts=({isOver:e,dndState:t})=>`relative flex items-center px-2 mb-2 -mt-2 rounded-lg border-2 border-transparent hover:border-border min-h-14
        ${e&&"!border-warning shadow-md shadow-warning"} 
        ${t.isDragging&&!e&&"!border-default"}
        ${t.isDragging&&!t.isOver&&"shadow-md shadow-default"}
        transition-all`,ns=k("students/shuffleAssignedStudents",async(e,{getState:t,dispatch:n})=>{const r=t().grid.deskSetup,a=r.flat().filter(l=>l.deskState===1&&l.isLocked===!1).map(l=>l.studentId);n(I());const u=[];for(let l=0;l<r.length;l++){const d=r[l];for(let o=0;o<d.length;o++){const i=d[o];i.deskState===1&&i.isLocked===!1&&u.push({row:l,col:o})}}const p=a.sort(()=>Math.random()-.5),f=u.sort(()=>Math.random()-.5);p.forEach((l,d)=>{if(f[d]){const{row:o,col:i}=f[d];l&&(n(v({id:l,val:!0})),n(S({row:o,col:i,id:l})))}})}),os=({link:e,copied:t,setCopied:n})=>{const c=m(),r=()=>{navigator.clipboard.writeText(e),n(!0)};return s.jsx("button",{onClick:r,className:`pl-4 py-2 pr-4 border-default border-2 rounded-r-lg hover:bg-hover ${t&&"border-success hover:bg-success"} transition-colors`,"aria-label":"Copy link to clipboard",children:s.jsx(j,{value:c("common.copy")})})},rs=()=>{const[e,t]=x.useState(!1),n=m(),c=g(y),r=g(u=>u.grid.deskSetup),a=z(r,c);return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("input",{className:"w-full bg-card text-text-muted border-element border-y-2 border-l-2 rounded-l-lg py-2 pl-2 font-medium",value:a,disabled:!0}),s.jsx(os,{link:a,copied:e,setCopied:t})]}),e&&s.jsx("h6",{className:"font-semibold text-sm text-success pl-2",children:n("components.export.copiedToClipboard")})]})},cs=()=>{const{showModal:e,hideModal:t}=$(),n=m();return()=>e({title:n("modals.export.heading"),component:s.jsx(rs,{}),confirmText:n("common.done"),cancelText:n("common.cancel"),onCancel:t})},as=()=>{const e=h(),t=()=>{e(L(!0))};return s.jsx(A,{onClick:t,children:s.jsx(P,{size:16,strokeWidth:3,color:"currentcolor"})})},ls=()=>{const e=h(),t=()=>{e(L(!1))};return s.jsx(A,{onClick:t,children:s.jsx(U,{size:16,strokeWidth:3,color:"currentcolor"})})},ds=()=>{const e=m();return s.jsx(H,{text:e("screens.assign.lockedInfoText"),children:s.jsx("div",{className:"flex justify-center items-center h-full text-text-muted-extra font-semibold",children:s.jsx(q,{size:24,strokeWidth:2,color:"currentcolor"})})})},xs=()=>{const e=h(),t=cs(),n=m(),c=()=>{e(_(2))},r=()=>{t()};return s.jsxs(s.Fragment,{children:[s.jsx(w,{className:"relative",children:s.jsx(es,{})}),s.jsxs(w,{className:"flex flex-col gap-4",children:[s.jsx(R,{disabled:!0}),s.jsxs("div",{className:"flex flex-row justify-between w-full",children:[s.jsxs("div",{className:"flex flex-row gap-2",children:[s.jsx(as,{}),s.jsx(ls,{}),s.jsx(ds,{})]}),s.jsx(D,{onClick:()=>e(ns()),children:n("screens.assign.shuffle")})]})]}),s.jsxs(w,{className:"flex flex-row justify-between",children:[s.jsx(N,{onClick:c,children:n("common.goBack")}),s.jsx(A,{onClick:r,children:n("common.export")})]})]})};export{xs as default};
